/*
 * storyscroll.js v3.0.0
 * (c) 2019 Little Linghuan & Esone
 * Released under the GPL license
 * ieexx.com
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("./pixi.js"),require("gsap/TweenMax")):"function"==typeof define&&define.amd?define(["./pixi.js","gsap/TweenMax"],e):(t=t||self).StoryScroll=e(t.PIXI,t.TweenMax)}(this,function(a,n){"use strict";function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),o.forEach(function(t){r(e,t,i[t])})}return e}var e,v,S,i,l,t=navigator.userAgent,_=(navigator.appVersion,t.indexOf("Trident"),t.indexOf("Presto"),t.indexOf("AppleWebKit"),-1<t.indexOf("Gecko")&&t.indexOf("KHTML"),t.match(/AppleWebKit.*Mobile.*/),t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),-1<t.indexOf("Android")||t.indexOf("Adr"),t.indexOf("iPhone"),t.indexOf("iPad"),t.indexOf("Safari"),-1<t.indexOf("MicroMessenger"));t.indexOf("Weibo"),t.match(/\sQQ/i);e=window,v=Date.now||function(){return+new Date},S={},i=1,e.core?core.effect||(core.effect={}):e.core={effect:{}},core.effect.Animate={requestAnimationFrame:function(){var i=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame,t=!!i;if(i&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(i.toString())&&(t=!1),t)return function(t,e){i(t,e)};var o={},n=1,r=null,s=+new Date;return function(t,e){var i=n++;return o[i]=t,null===r&&(r=setInterval(function(){var t=+new Date,e=o;for(var i in o={},e)e.hasOwnProperty(i)&&(e[i](t),s=t);2500<t-s&&(clearInterval(r),r=null)},1e3/60)),i}}(),stop:function(t){var e=null!=S[t];return e&&(S[t]=null),e},isRunning:function(t){return null!=S[t]},start:function(l,a,c,_,h,p){var u=v(),f=u,d=0,g=0,m=i++;if(p=p||document.body,m%20==0){var t={};for(var e in S)t[e]=!0;S=t}return S[m]=!0,core.effect.Animate.requestAnimationFrame(function t(e){var i=!0!==e,o=v();if(!S[m]||a&&!a(m))return S[m]=null,void(c&&c(60-g/((o-u)/1e3),m,!1));if(i)for(var n=Math.round((o-f)/(1e3/60))-1,r=0;r<Math.min(n,4);r++)t(!0),g++;_&&1<(d=(o-u)/_)&&(d=1);var s=h?h(d):d;!1!==l(s,o,i)&&1!==d||!i?i&&(f=o,core.effect.Animate.requestAnimationFrame(t,p)):(S[m]=null,c&&c(60-g/((o-u)/1e3),m,1===d||null==_))},p),m}},function(){function o(){}function p(t){return Math.pow(t-1,3)+1}function u(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)}var t={__isSingleTouch:!(l=function(t,e){for(var i in this.__callback=t,this.options={scrollingX:!0,scrollingY:!0,animating:!0,animationDuration:250,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3,speedMultiplier:1,scrollingComplete:o,penetrationDeceleration:.03,penetrationAcceleration:.08},e)this.options[i]=e[i]}),__isTracking:!1,__didDecelerationComplete:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__refreshHeight:null,__refreshActive:!1,__refreshActivate:null,__refreshDeactivate:null,__refreshStart:null,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(t,e,i,o){var n=this;t===+t&&(n.__clientWidth=t),e===+e&&(n.__clientHeight=e),i===+i&&(n.__contentWidth=i),o===+o&&(n.__contentHeight=o),n.__computeScrollMax(),n.scrollTo(n.__scrollLeft,n.__scrollTop,!0)},setPosition:function(t,e){this.__clientLeft=t||0,this.__clientTop=e||0},setSnapSize:function(t,e){this.__snapWidth=t,this.__snapHeight=e},activatePullToRefresh:function(t,e,i,o){this.__refreshHeight=t,this.__refreshActivate=e,this.__refreshDeactivate=i,this.__refreshStart=o},triggerPullToRefresh:function(){this.__publish(this.__scrollLeft,-this.__refreshHeight,this.__zoomLevel,!0),this.__refreshStart&&this.__refreshStart()},finishPullToRefresh:function(){var t=this;t.__refreshActive=!1,t.__refreshDeactivate&&t.__refreshDeactivate(),t.scrollTo(t.__scrollLeft,t.__scrollTop,!0)},getValues:function(){return{left:this.__scrollLeft,top:this.__scrollTop,zoom:this.__zoomLevel}},getScrollMax:function(){return{left:this.__maxScrollLeft,top:this.__maxScrollTop}},zoomTo:function(t,e,i,o,n){var r=this;if(!r.options.zooming)throw new Error("Zooming is not enabled!");n&&(r.__zoomComplete=n),r.__isDecelerating&&(core.effect.Animate.stop(r.__isDecelerating),r.__isDecelerating=!1);var s=r.__zoomLevel;null==i&&(i=r.__clientWidth/2),null==o&&(o=r.__clientHeight/2),t=Math.max(Math.min(t,r.options.maxZoom),r.options.minZoom),r.__computeScrollMax(t);var l=(i+r.__scrollLeft)*t/s-i,a=(o+r.__scrollTop)*t/s-o;l>r.__maxScrollLeft?l=r.__maxScrollLeft:l<0&&(l=0),a>r.__maxScrollTop?a=r.__maxScrollTop:a<0&&(a=0),r.__publish(l,a,t,e)},zoomBy:function(t,e,i,o,n){this.zoomTo(this.__zoomLevel*t,e,i,o,n)},scrollTo:function(t,e,i,o){var n=this;if(n.__isDecelerating&&(core.effect.Animate.stop(n.__isDecelerating),n.__isDecelerating=!1),null!=o&&o!==n.__zoomLevel){if(!n.options.zooming)throw new Error("Zooming is not enabled!");t*=o,e*=o,n.__computeScrollMax(o)}else o=n.__zoomLevel;n.options.scrollingX?n.options.paging?t=Math.round(t/n.__clientWidth)*n.__clientWidth:n.options.snapping&&(t=Math.round(t/n.__snapWidth)*n.__snapWidth):t=n.__scrollLeft,n.options.scrollingY?n.options.paging?e=Math.round(e/n.__clientHeight)*n.__clientHeight:n.options.snapping&&(e=Math.round(e/n.__snapHeight)*n.__snapHeight):e=n.__scrollTop,t=Math.max(Math.min(n.__maxScrollLeft,t),0),e=Math.max(Math.min(n.__maxScrollTop,e),0),t===n.__scrollLeft&&e===n.__scrollTop&&(i=!1),n.__isTracking||n.__publish(t,e,o,i)},scrollBy:function(t,e,i){var o=this,n=o.__isAnimating?o.__scheduledLeft:o.__scrollLeft,r=o.__isAnimating?o.__scheduledTop:o.__scrollTop;o.scrollTo(n+(t||0),r+(e||0),i)},doMouseZoom:function(t,e,i,o){var n=0<t?.97:1.03;return this.zoomTo(this.__zoomLevel*n,!1,i-this.__clientLeft,o-this.__clientTop)},doTouchStart:function(t,e){if(null==t.length)throw new Error("Invalid touch list: "+t);if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var i,o,n=this;n.__interruptedAnimation=!0,n.__isDecelerating&&(core.effect.Animate.stop(n.__isDecelerating),n.__isDecelerating=!1,n.__interruptedAnimation=!0),n.__isAnimating&&(core.effect.Animate.stop(n.__isAnimating),n.__isAnimating=!1,n.__interruptedAnimation=!0);var r=1===t.length;o=r?(i=t[0].pageX,t[0].pageY):(i=Math.abs(t[0].pageX+t[1].pageX)/2,Math.abs(t[0].pageY+t[1].pageY)/2),n.__initialTouchLeft=i,n.__initialTouchTop=o,n.__zoomLevelStart=n.__zoomLevel,n.__lastTouchLeft=i,n.__lastTouchTop=o,n.__lastTouchMove=e,n.__lastScale=1,n.__enableScrollX=!r&&n.options.scrollingX,n.__enableScrollY=!r&&n.options.scrollingY,n.__isTracking=!0,n.__didDecelerationComplete=!1,n.__isDragging=!r,n.__isSingleTouch=r,n.__positions=[]},doTouchMove:function(t,e,i){if(null==t.length)throw new Error("Invalid touch list: "+t);if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var o=this;if(o.__isTracking){var n,r;r=2===t.length?(n=Math.abs(t[0].pageX+t[1].pageX)/2,Math.abs(t[0].pageY+t[1].pageY)/2):(n=t[0].pageX,t[0].pageY);var s=o.__positions;if(o.__isDragging){var l=n-o.__lastTouchLeft,a=r-o.__lastTouchTop,c=o.__scrollLeft,_=o.__scrollTop,h=o.__zoomLevel;if(null!=i&&o.options.zooming){var p=h;if(h=h/o.__lastScale*i,p!==(h=Math.max(Math.min(h,o.options.maxZoom),o.options.minZoom))){var u=n-o.__clientLeft,f=r-o.__clientTop;c=(u+c)*h/p-u,_=(f+_)*h/p-f,o.__computeScrollMax(h)}}if(o.__enableScrollX){c-=l*this.options.speedMultiplier;var d=o.__maxScrollLeft;(d<c||c<0)&&(o.options.bouncing?c+=l/2*this.options.speedMultiplier:c=d<c?d:0)}if(o.__enableScrollY){_-=a*this.options.speedMultiplier;var g=o.__maxScrollTop;(g<_||_<0)&&(o.options.bouncing?(_+=a/2*this.options.speedMultiplier,o.__enableScrollX||null==o.__refreshHeight||(!o.__refreshActive&&_<=-o.__refreshHeight?(o.__refreshActive=!0,o.__refreshActivate&&o.__refreshActivate()):o.__refreshActive&&_>-o.__refreshHeight&&(o.__refreshActive=!1,o.__refreshDeactivate&&o.__refreshDeactivate()))):_=g<_?g:0)}60<s.length&&s.splice(0,30),s.push(c,_,e),o.__publish(c,_,h)}else{var m=o.options.locking?3:0,v=Math.abs(n-o.__initialTouchLeft),S=Math.abs(r-o.__initialTouchTop);o.__enableScrollX=o.options.scrollingX&&m<=v,o.__enableScrollY=o.options.scrollingY&&m<=S,s.push(o.__scrollLeft,o.__scrollTop,e),o.__isDragging=(o.__enableScrollX||o.__enableScrollY)&&(5<=v||5<=S),o.__isDragging&&(o.__interruptedAnimation=!1)}o.__lastTouchLeft=n,o.__lastTouchTop=r,o.__lastTouchMove=e,o.__lastScale=i}},doTouchEnd:function(t){if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t);var e=this;if(e.__isTracking){if(e.__isTracking=!1,e.__isDragging)if(e.__isDragging=!1,e.__isSingleTouch&&e.options.animating&&t-e.__lastTouchMove<=100){for(var i=e.__positions,o=i.length-1,n=o,r=o;0<r&&i[r]>e.__lastTouchMove-100;r-=3)n=r;if(n!==o){var s=i[o]-i[n],l=e.__scrollLeft-i[n-2],a=e.__scrollTop-i[n-1];e.__decelerationVelocityX=l/s*(1e3/60),e.__decelerationVelocityY=a/s*(1e3/60);var c=e.options.paging||e.options.snapping?4:1;Math.abs(e.__decelerationVelocityX)>c||Math.abs(e.__decelerationVelocityY)>c?e.__refreshActive||e.__startDeceleration(t):e.options.scrollingComplete()}else e.options.scrollingComplete()}else 100<t-e.__lastTouchMove&&e.options.scrollingComplete();e.__isDecelerating||(e.__refreshActive&&e.__refreshStart?(e.__publish(e.__scrollLeft,-e.__refreshHeight,e.__zoomLevel,!0),e.__refreshStart&&e.__refreshStart()):((e.__interruptedAnimation||e.__isDragging)&&e.options.scrollingComplete(),e.scrollTo(e.__scrollLeft,e.__scrollTop,!0,e.__zoomLevel),e.__refreshActive&&(e.__refreshActive=!1,e.__refreshDeactivate&&e.__refreshDeactivate()))),e.__positions.length=0}},__publish:function(t,e,i,o){var n=this,r=n.__isAnimating;if(r&&(core.effect.Animate.stop(r),n.__isAnimating=!1),o&&n.options.animating){n.__scheduledLeft=t,n.__scheduledTop=e,n.__scheduledZoom=i;var s=n.__scrollLeft,l=n.__scrollTop,a=n.__zoomLevel,c=t-s,_=e-l,h=i-a;n.__isAnimating=core.effect.Animate.start(function(t,e,i){i&&(n.__scrollLeft=s+c*t,n.__scrollTop=l+_*t,n.__zoomLevel=a+h*t,n.__callback&&n.__callback(n.__scrollLeft,n.__scrollTop,n.__zoomLevel))},function(t){return n.__isAnimating===t},function(t,e,i){e===n.__isAnimating&&(n.__isAnimating=!1),(n.__didDecelerationComplete||i)&&n.options.scrollingComplete(),n.options.zooming&&(n.__computeScrollMax(),n.__zoomComplete&&(n.__zoomComplete(),n.__zoomComplete=null))},n.options.animationDuration,r?p:u)}else n.__scheduledLeft=n.__scrollLeft=t,n.__scheduledTop=n.__scrollTop=e,n.__scheduledZoom=n.__zoomLevel=i,n.__callback&&n.__callback(t,e,i),n.options.zooming&&(n.__computeScrollMax(),n.__zoomComplete&&(n.__zoomComplete(),n.__zoomComplete=null))},__computeScrollMax:function(t){var e=this;null==t&&(t=e.__zoomLevel),e.__maxScrollLeft=Math.max(e.__contentWidth*t-e.__clientWidth,0),e.__maxScrollTop=Math.max(e.__contentHeight*t-e.__clientHeight,0)},__startDeceleration:function(t){var o=this;if(o.options.paging){var e=Math.max(Math.min(o.__scrollLeft,o.__maxScrollLeft),0),i=Math.max(Math.min(o.__scrollTop,o.__maxScrollTop),0),n=o.__clientWidth,r=o.__clientHeight;o.__minDecelerationScrollLeft=Math.floor(e/n)*n,o.__minDecelerationScrollTop=Math.floor(i/r)*r,o.__maxDecelerationScrollLeft=Math.ceil(e/n)*n,o.__maxDecelerationScrollTop=Math.ceil(i/r)*r}else o.__minDecelerationScrollLeft=0,o.__minDecelerationScrollTop=0,o.__maxDecelerationScrollLeft=o.__maxScrollLeft,o.__maxDecelerationScrollTop=o.__maxScrollTop;var s=o.options.snapping?4:.001;o.__isDecelerating=core.effect.Animate.start(function(t,e,i){o.__stepThroughDeceleration(i)},function(){var t=Math.abs(o.__decelerationVelocityX)>=s||Math.abs(o.__decelerationVelocityY)>=s;return t||(o.__didDecelerationComplete=!0),t},function(t,e,i){o.__isDecelerating=!1,o.__didDecelerationComplete&&o.options.scrollingComplete(),o.scrollTo(o.__scrollLeft,o.__scrollTop,o.options.snapping)})},__stepThroughDeceleration:function(t){var e=this,i=e.__scrollLeft+e.__decelerationVelocityX,o=e.__scrollTop+e.__decelerationVelocityY;if(!e.options.bouncing){var n=Math.max(Math.min(e.__maxDecelerationScrollLeft,i),e.__minDecelerationScrollLeft);n!==i&&(i=n,e.__decelerationVelocityX=0);var r=Math.max(Math.min(e.__maxDecelerationScrollTop,o),e.__minDecelerationScrollTop);r!==o&&(o=r,e.__decelerationVelocityY=0)}if(t?e.__publish(i,o,e.__zoomLevel):(e.__scrollLeft=i,e.__scrollTop=o),!e.options.paging){e.__decelerationVelocityX*=.95,e.__decelerationVelocityY*=.95}if(e.options.bouncing){var s=0,l=0,a=e.options.penetrationDeceleration,c=e.options.penetrationAcceleration;i<e.__minDecelerationScrollLeft?s=e.__minDecelerationScrollLeft-i:i>e.__maxDecelerationScrollLeft&&(s=e.__maxDecelerationScrollLeft-i),o<e.__minDecelerationScrollTop?l=e.__minDecelerationScrollTop-o:o>e.__maxDecelerationScrollTop&&(l=e.__maxDecelerationScrollTop-o),0!==s&&(s*e.__decelerationVelocityX<=0?e.__decelerationVelocityX+=s*a:e.__decelerationVelocityX=s*c),0!==l&&(l*e.__decelerationVelocityY<=0?e.__decelerationVelocityY+=l*a:e.__decelerationVelocityY=l*c)}}};for(var e in t)l.prototype[e]=t[e]}();var h=l;return function(){function i(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),r(this,"designWidth",void 0),r(this,"designLength",void 0),r(this,"contentWidth",void 0),r(this,"contentLength",void 0),r(this,"viewWidth",void 0),r(this,"viewLength",void 0),r(this,"deviceWidth",void 0),r(this,"deviceHeight",void 0),r(this,"maxScroll",1e4),r(this,"storyPosition",0),this._defaultSetting(t),this._createContainer(t),window.onresize=function(){return e._windowResize()},this._windowResize()}return function(t,e,i){e&&o(t.prototype,e),i&&o(t,i)}(i,[{key:"chapter",value:function(t,e){var o=this,n=new a.Container;return this._setProps(n,t),n.sprite=function(t,e){return o.sprite(t,e,n)},n.spriteAnimated=function(t,e,i){return o.spriteAnimated(t,e,i,n)},n.graphic=function(t){return o.graphic(t,n)},n.chapter=function(t){return o.chapter(t,n)},this._setActions(n),e?e.addChild(n):this.containerScroll.addChild(n),n}},{key:"sprite",value:function(t,e,i){var o=this._createSprite(t,e);return this._setActions(o),i?i.addChild(o):this.containerScroll.addChild(o),o}},{key:"spriteAnimated",value:function(t,e,i,o){var n=this._createAnimatedSprite(t,e,i);return this._setActions(n),o?o.addChild(n):this.containerScroll.addChild(n),!1!==i&&n.play(),n}},{key:"graphic",value:function(t,e){var i=new a.Graphics;return this._setProps(i,t),this._setActions(i),e?e.addChild(i):this.containerScroll.addChild(i),i}},{key:"act",value:function(t,e,i,o){void 0===o&&(o=this._getSpriteTriggerPosition(t)),t.actions||(t.actions={});var n=this._createHash(8);return t.actions[n]={action:{type:"point",props:e,duration:i,triggerPosition:o}},this.actions.push(s({sprite:t,hash:n},t.actions[n].action)),t}},{key:"actByStep",value:function(t,e,i,o){void 0===o&&(o=this._getSpriteTriggerPosition(t)),t.actions||(t.actions={});var n=this._createHash(8);return t.actions[n]={action:{type:"section",props:e,section:i,triggerPosition:o}},this.actions.push(s({sprite:t,hash:n},t.actions[n].action)),t}},{key:"setPin",value:function(t,e,i){t.actions||(t.actions={});var o=this._createHash();return t.actions[o]={action:{type:"pin",section:i,triggerPosition:e}},this.actions.push(s({sprite:t,hash:o},t.actions[o].action)),t}},{key:"_scrollerCallback",value:function(t,e,i){var o=this;this.scrollPosition=this._getSrollPosition(t,e),this.storyPosition=this.scrollPosition/this._scale,"y"==this.scrollDirection?this.containerScroll.y=-this.storyPosition:this.containerScroll.x=-this.storyPosition,this.actions.forEach(function(t){"point"==t.type?function(t){var e=t.sprite.actions[t.hash];if(this.storyPosition>t.triggerPosition){if("acting"!=e.status&&"done"!=e.status){t.props.onComplete=function(t){return e.status="done"},t.props.onReverseComplete=function(t){return e.status="reversed"};var i=n.TweenMax.to(t.sprite,t.duration,t.props);e.tween=i,e.status="acting"}}else"acting"!=e.status&&"done"!=e.status||e.tween&&(e.status="reversing",e.tween.reverse())}.call(o,t):"section"==t.type?function(t){var e=t.sprite.actions[t.hash];t.triggerPosition<this.storyPosition&&this.storyPosition<t.triggerPosition+t.section?i("during",e,t,this.storyPosition):this.storyPosition>=t.triggerPosition+t.section?i("after",e,t,this.storyPosition):this.storyPosition<=t.triggerPosition&&i("before",e,t,this.storyPosition);function s(t,e,i,o,n){return o+(i-t)/(e-t)*(n-o)}function i(t,e,i,o){for(var n in t=t||"before",e.originProps=e.originProps||{},i.props)if("object"==c(i.props[n]))for(var r in i.props[n])void 0===e.originProps[n]&&(e.originProps[n]={}),void 0===e.originProps[n][r]&&(e.originProps[n][r]=i.sprite[n][r]),i.sprite[n][r]="before"==t?e.originProps[n][r]:"after"==t?i.props[n][r]:s(i.triggerPosition,i.triggerPosition+i.section,o,e.originProps[n][r],i.props[n][r]);else void 0===e.originProps[n]&&(e.originProps[n]=i.sprite[n]),i.sprite[n]="before"==t?e.originProps[n]:"after"==t?i.props[n]:s(i.triggerPosition,i.triggerPosition+i.section,o,e.originProps[n],i.props[n])}}.call(o,t):"pin"==t.type&&function(t){var e=t.sprite.actions[t.hash];e.originProps=e.originProps||{},void 0===e.originProps[this.scrollDirection]&&(e.originProps[this.scrollDirection]=t.sprite[this.scrollDirection]);t.sprite[this.scrollDirection]=e.originProps[this.scrollDirection]-t.triggerPosition+this.storyPosition}.call(o,t)}),this.debug&&("all"==this.debug&&(console.log("top:",e),console.log("left:",t),console.log("scrollPosition :",this.scrollPosition)),console.log("storyPosition :",this.storyPosition))}},{key:"_defaultSetting",value:function(t){var o=this;this.scrollDirection=t.direction||"y",this.designWidth=t.width||750,this.designLength=t.length||1e4,this.debug=t.debug||!1,this.containerSelector=t.container,this._clientWidth=document.documentElement.clientWidth||window.innerWidth,this._clientHeight=document.documentElement.clientHeight||window.innerHeight,this.designOrientation="y"==this.scrollDirection?"portrait":"landscape",this.actionList=[],this.actions=[],this.loaderList=[],this.scroller=new h(function(t,e,i){return o._scrollerCallback(t,e,i)},{zooming:!1,animating:!0,bouncing:!1,animationDuration:1e3}),this.scroller.__enableScrollY=!0,this.storyPosition=0;var e=!1;document.addEventListener("touchstart",function(t){o.scroller.doTouchStart(t.touches,t.timeStamp),e=!0},!1),document.addEventListener("touchmove",function(t){e&&(o.scroller.doTouchMove(t.touches,t.timeStamp),e=!0)},!1),document.addEventListener("touchend",function(t){e&&(o.scroller.doTouchEnd(t.timeStamp),e=!1)},!1)}},{key:"_createContainer",value:function(t){(this.app=new a.Application({width:this._clientWidth,height:this._clientHeight,backgroundColor:t.backgroundColor,antialias:!0}),void 0===this.containerSelector)?document.body.appendChild(document.createElement("main")).appendChild(this.app.view):document.querySelector(this.containerSelector).appendChild(this.app.view);this.containerFitWindow=new a.Container,this.containerFitWindow.pivot.set(0,0),this.containerScroll=new a.Container,this.containerScroll.name="story",this.containerFitWindow.addChild(this.containerScroll),this.app.stage.addChild(this.containerFitWindow)}},{key:"_windowResize",value:function(){var t=this;this.deviceOrientation=this._getDeviceOrientation(),this.deviceWidth="portrait"==this.deviceOrientation?this._clientWidth:this._clientHeight,this.deviceHeight="portrait"==this.deviceOrientation?this._clientHeight:this._clientWidth,this._scalePrev=this._scale,this._scale=this.deviceWidth/this.designWidth,this.maxScroll=this.designLength-this.deviceHeight,this.contentWidth=this.deviceWidth,this.contentLength=this.designLength*this._scale,this.viewWidth=this.designWidth,this.viewLength=this.deviceHeight/this._scale,this._setContainerRotation(this.containerFitWindow,this.designOrientation,this.deviceOrientation,this.deviceWidth),this.containerFitWindow.scale.set(this._scale,this._scale),this.app.renderer.resize(this._clientWidth,this._clientHeight);var e="portrait"==this.deviceOrientation?this.deviceWidth:this.contentLength,i="portrait"==this.deviceOrientation?this.contentLength:this.deviceWidth,o="portrait"==this.deviceOrientation?0:this.scrollPosition/this._scalePrev*this._scale||0,n="portrait"!==this.deviceOrientation?0:this.scrollPosition/this._scalePrev*this._scale||0;setTimeout(function(){t.scroller.setDimensions(t._clientWidth,t._clientHeight,e,i),t.scroller.scrollTo(o,n,!1)},200)}},{key:"_getDeviceOrientation",value:function(){return this._clientWidth=document.documentElement.clientWidth||window.innerWidth,this._clientHeight=document.documentElement.clientHeight||window.innerHeight,_?180===window.orientation||0===window.orientation?"portrait":90===window.orientation||-90===window.orientation?"landscape":void 0:this._clientWidth<this._clientHeight?"portrait":"landscape"}},{key:"_setContainerRotation",value:function(t,e,i,o){var n={design_portrait:{device_portrait:{rotation:0,offsetX:0,offsetY:0},device_landscape:{rotation:-Math.PI/2,offsetX:0,offsetY:o}},design_landscape:{device_portrait:{rotation:Math.PI/2,offsetX:o,offsetY:0},device_landscape:{rotation:0,offsetX:0,offsetY:0}}};t.rotation=n["design_"+e]["device_"+i].rotation,t.position.set(n["design_"+e]["device_"+i].offsetX,n["design_"+e]["device_"+i].offsetY)}},{key:"_getSpriteTriggerPosition",value:function(t){var e="x"==this.scrollDirection?t.x:t.y;return t.parent&&"story"!=t.parent.name?e+this._getSpriteTriggerPosition(t.parent):e-2*this.pageHeight/3}},{key:"_getSrollPosition",value:function(t,e){var i,o,n;return(n={design_portrait:{device_portrait:{x:i=t,y:o=e},device_landscape:{x:o,y:i}},design_landscape:{device_portrait:{x:o,y:i},device_landscape:{x:i,y:o}}},function(t,e,i){return n["design_"+t]["device_"+e][i]})(this.designOrientation,this.deviceOrientation,this.scrollDirection)}},{key:"_createSprite",value:function(t,e){var i=new a.Sprite.from(t);return this._setProps(i,e),i}},{key:"_createAnimatedSprite",value:function(t,e,r){var s=[],l=new a.AnimatedSprite([a.Texture.EMPTY]);return"object"==c(t)&&0<t.length?(t.forEach(function(t){s.push(a.Texture.from(t))}),l.textures=s):this.app.loader.add("spritesheet",t).load(function(t,e){for(var i in e.spritesheet.data.frames){var o=a.Texture.from(i),n=e.spritesheet.data.frames[i].duration;s.push(n?{texture:o,time:n}:o)}l.textures=s,!1!==r&&l.play()}),this._setProps(l,e),l}},{key:"_setActions",value:function(o){var n=this;o.act=function(t,e,i){return n.act(o,t,e,i)},o.actByStep=function(t,e,i){return n.actByStep(o,t,e,i)},o.setPin=function(t,e){return n.setPin(o,t,e)}}},{key:"_setProps",value:function(t,e){if(e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}},{key:"_createHash",value:function(t){return Array.from(Array(Number(t)||24),function(){return Math.floor(36*Math.random()).toString(36)}).join("")}}]),i}()});