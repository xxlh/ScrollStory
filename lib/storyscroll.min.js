/*
 * storyscroll v3.4.0
 * (c) 2019 Little Linghuan & Esone
 * Released under the GPL license
 * ieexx.com
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("pixi.js")):"function"==typeof define&&define.amd?define(["pixi.js"],t):(e=e||self).StoryScroll=t(e.PIXI)}(this,function(s){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,o)}return i}function l(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(i,!0).forEach(function(e){r(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var t,v,S,i,c,e=navigator.userAgent,_=(navigator.appVersion,e.indexOf("Trident"),e.indexOf("Presto"),e.indexOf("AppleWebKit"),-1<e.indexOf("Gecko")&&e.indexOf("KHTML"),e.match(/AppleWebKit.*Mobile.*/),e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),-1<e.indexOf("Android")||e.indexOf("Adr"),e.indexOf("iPhone"),e.indexOf("iPad"),e.indexOf("Safari"),-1<e.indexOf("MicroMessenger"));e.indexOf("Weibo"),e.match(/\sQQ/i);t=window,v=Date.now||function(){return+new Date},S={},i=1,t.core?core.effect||(core.effect={}):t.core={effect:{}},core.effect.Animate={requestAnimationFrame:function(){var i=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame,e=!!i;if(i&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(i.toString())&&(e=!1),e)return function(e,t){i(e,t)};var o={},n=1,r=null,l=+new Date;return function(e,t){var i=n++;return o[i]=e,null===r&&(r=setInterval(function(){var e=+new Date,t=o;for(var i in o={},t)t.hasOwnProperty(i)&&(t[i](e),l=e);2500<e-l&&(clearInterval(r),r=null)},1e3/60)),i}}(),stop:function(e){var t=null!=S[e];return t&&(S[e]=null),t},isRunning:function(e){return null!=S[e]},start:function(s,a,c,_,h,p){var u=v(),f=u,d=0,g=0,m=i++;if(p=p||document.body,m%20==0){var e={};for(var t in S)e[t]=!0;S=e}return S[m]=!0,core.effect.Animate.requestAnimationFrame(function e(t){var i=!0!==t,o=v();if(!S[m]||a&&!a(m))return S[m]=null,void(c&&c(60-g/((o-u)/1e3),m,!1));if(i)for(var n=Math.round((o-f)/(1e3/60))-1,r=0;r<Math.min(n,4);r++)e(!0),g++;_&&1<(d=(o-u)/_)&&(d=1);var l=h?h(d):d;!1!==s(l,o,i)&&1!==d||!i?i&&(f=o,core.effect.Animate.requestAnimationFrame(e,p)):(S[m]=null,c&&c(60-g/((o-u)/1e3),m,1===d||null==_))},p),m}},function(){function o(){}function p(e){return Math.pow(e-1,3)+1}function u(e){return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2)}var e={__isSingleTouch:!(c=function(e,t){for(var i in this.__callback=e,this.options={scrollingX:!0,scrollingY:!0,animating:!0,animationDuration:250,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3,speedMultiplier:1,scrollingComplete:o,penetrationDeceleration:.03,penetrationAcceleration:.08},t)this.options[i]=t[i]}),__isTracking:!1,__didDecelerationComplete:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__refreshHeight:null,__refreshActive:!1,__refreshActivate:null,__refreshDeactivate:null,__refreshStart:null,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(e,t,i,o){var n=this;e===+e&&(n.__clientWidth=e),t===+t&&(n.__clientHeight=t),i===+i&&(n.__contentWidth=i),o===+o&&(n.__contentHeight=o),n.__computeScrollMax(),n.scrollTo(n.__scrollLeft,n.__scrollTop,!0)},setPosition:function(e,t){this.__clientLeft=e||0,this.__clientTop=t||0},setSnapSize:function(e,t){this.__snapWidth=e,this.__snapHeight=t},activatePullToRefresh:function(e,t,i,o){this.__refreshHeight=e,this.__refreshActivate=t,this.__refreshDeactivate=i,this.__refreshStart=o},triggerPullToRefresh:function(){this.__publish(this.__scrollLeft,-this.__refreshHeight,this.__zoomLevel,!0),this.__refreshStart&&this.__refreshStart()},finishPullToRefresh:function(){var e=this;e.__refreshActive=!1,e.__refreshDeactivate&&e.__refreshDeactivate(),e.scrollTo(e.__scrollLeft,e.__scrollTop,!0)},getValues:function(){return{left:this.__scrollLeft,top:this.__scrollTop,zoom:this.__zoomLevel}},getScrollMax:function(){return{left:this.__maxScrollLeft,top:this.__maxScrollTop}},zoomTo:function(e,t,i,o,n){var r=this;if(!r.options.zooming)throw new Error("Zooming is not enabled!");n&&(r.__zoomComplete=n),r.__isDecelerating&&(core.effect.Animate.stop(r.__isDecelerating),r.__isDecelerating=!1);var l=r.__zoomLevel;null==i&&(i=r.__clientWidth/2),null==o&&(o=r.__clientHeight/2),e=Math.max(Math.min(e,r.options.maxZoom),r.options.minZoom),r.__computeScrollMax(e);var s=(i+r.__scrollLeft)*e/l-i,a=(o+r.__scrollTop)*e/l-o;s>r.__maxScrollLeft?s=r.__maxScrollLeft:s<0&&(s=0),a>r.__maxScrollTop?a=r.__maxScrollTop:a<0&&(a=0),r.__publish(s,a,e,t)},zoomBy:function(e,t,i,o,n){this.zoomTo(this.__zoomLevel*e,t,i,o,n)},scrollTo:function(e,t,i,o){var n=this;if(n.__isDecelerating&&(core.effect.Animate.stop(n.__isDecelerating),n.__isDecelerating=!1),null!=o&&o!==n.__zoomLevel){if(!n.options.zooming)throw new Error("Zooming is not enabled!");e*=o,t*=o,n.__computeScrollMax(o)}else o=n.__zoomLevel;n.options.scrollingX?n.options.paging?e=Math.round(e/n.__clientWidth)*n.__clientWidth:n.options.snapping&&(e=Math.round(e/n.__snapWidth)*n.__snapWidth):e=n.__scrollLeft,n.options.scrollingY?n.options.paging?t=Math.round(t/n.__clientHeight)*n.__clientHeight:n.options.snapping&&(t=Math.round(t/n.__snapHeight)*n.__snapHeight):t=n.__scrollTop,e=Math.max(Math.min(n.__maxScrollLeft,e),0),t=Math.max(Math.min(n.__maxScrollTop,t),0),e===n.__scrollLeft&&t===n.__scrollTop&&(i=!1),n.__isTracking||n.__publish(e,t,o,i)},scrollBy:function(e,t,i){var o=this,n=o.__isAnimating?o.__scheduledLeft:o.__scrollLeft,r=o.__isAnimating?o.__scheduledTop:o.__scrollTop;o.scrollTo(n+(e||0),r+(t||0),i)},doMouseZoom:function(e,t,i,o){var n=0<e?.97:1.03;return this.zoomTo(this.__zoomLevel*n,!1,i-this.__clientLeft,o-this.__clientTop)},doTouchStart:function(e,t){if(null==e.length)throw new Error("Invalid touch list: "+e);if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t);var i,o,n=this;n.__interruptedAnimation=!0,n.__isDecelerating&&(core.effect.Animate.stop(n.__isDecelerating),n.__isDecelerating=!1,n.__interruptedAnimation=!0),n.__isAnimating&&(core.effect.Animate.stop(n.__isAnimating),n.__isAnimating=!1,n.__interruptedAnimation=!0);var r=1===e.length;o=r?(i=e[0].pageX,e[0].pageY):(i=Math.abs(e[0].pageX+e[1].pageX)/2,Math.abs(e[0].pageY+e[1].pageY)/2),n.__initialTouchLeft=i,n.__initialTouchTop=o,n.__zoomLevelStart=n.__zoomLevel,n.__lastTouchLeft=i,n.__lastTouchTop=o,n.__lastTouchMove=t,n.__lastScale=1,n.__enableScrollX=!r&&n.options.scrollingX,n.__enableScrollY=!r&&n.options.scrollingY,n.__isTracking=!0,n.__didDecelerationComplete=!1,n.__isDragging=!r,n.__isSingleTouch=r,n.__positions=[]},doTouchMove:function(e,t,i){if(null==e.length)throw new Error("Invalid touch list: "+e);if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t);var o=this;if(o.__isTracking){var n,r;r=2===e.length?(n=Math.abs(e[0].pageX+e[1].pageX)/2,Math.abs(e[0].pageY+e[1].pageY)/2):(n=e[0].pageX,e[0].pageY);var l=o.__positions;if(o.__isDragging){var s=n-o.__lastTouchLeft,a=r-o.__lastTouchTop,c=o.__scrollLeft,_=o.__scrollTop,h=o.__zoomLevel;if(null!=i&&o.options.zooming){var p=h;if(h=h/o.__lastScale*i,p!==(h=Math.max(Math.min(h,o.options.maxZoom),o.options.minZoom))){var u=n-o.__clientLeft,f=r-o.__clientTop;c=(u+c)*h/p-u,_=(f+_)*h/p-f,o.__computeScrollMax(h)}}if(o.__enableScrollX){c-=s*this.options.speedMultiplier;var d=o.__maxScrollLeft;(d<c||c<0)&&(o.options.bouncing?c+=s/2*this.options.speedMultiplier:c=d<c?d:0)}if(o.__enableScrollY){_-=a*this.options.speedMultiplier;var g=o.__maxScrollTop;(g<_||_<0)&&(o.options.bouncing?(_+=a/2*this.options.speedMultiplier,o.__enableScrollX||null==o.__refreshHeight||(!o.__refreshActive&&_<=-o.__refreshHeight?(o.__refreshActive=!0,o.__refreshActivate&&o.__refreshActivate()):o.__refreshActive&&_>-o.__refreshHeight&&(o.__refreshActive=!1,o.__refreshDeactivate&&o.__refreshDeactivate()))):_=g<_?g:0)}60<l.length&&l.splice(0,30),l.push(c,_,t),o.__publish(c,_,h)}else{var m=o.options.locking?3:0,v=Math.abs(n-o.__initialTouchLeft),S=Math.abs(r-o.__initialTouchTop);o.__enableScrollX=o.options.scrollingX&&m<=v,o.__enableScrollY=o.options.scrollingY&&m<=S,l.push(o.__scrollLeft,o.__scrollTop,t),o.__isDragging=(o.__enableScrollX||o.__enableScrollY)&&(5<=v||5<=S),o.__isDragging&&(o.__interruptedAnimation=!1)}o.__lastTouchLeft=n,o.__lastTouchTop=r,o.__lastTouchMove=t,o.__lastScale=i}},doTouchEnd:function(e){if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var t=this;if(t.__isTracking){if(t.__isTracking=!1,t.__isDragging)if(t.__isDragging=!1,t.__isSingleTouch&&t.options.animating&&e-t.__lastTouchMove<=100){for(var i=t.__positions,o=i.length-1,n=o,r=o;0<r&&i[r]>t.__lastTouchMove-100;r-=3)n=r;if(n!==o){var l=i[o]-i[n],s=t.__scrollLeft-i[n-2],a=t.__scrollTop-i[n-1];t.__decelerationVelocityX=s/l*(1e3/60),t.__decelerationVelocityY=a/l*(1e3/60);var c=t.options.paging||t.options.snapping?4:1;Math.abs(t.__decelerationVelocityX)>c||Math.abs(t.__decelerationVelocityY)>c?t.__refreshActive||t.__startDeceleration(e):t.options.scrollingComplete()}else t.options.scrollingComplete()}else 100<e-t.__lastTouchMove&&t.options.scrollingComplete();t.__isDecelerating||(t.__refreshActive&&t.__refreshStart?(t.__publish(t.__scrollLeft,-t.__refreshHeight,t.__zoomLevel,!0),t.__refreshStart&&t.__refreshStart()):((t.__interruptedAnimation||t.__isDragging)&&t.options.scrollingComplete(),t.scrollTo(t.__scrollLeft,t.__scrollTop,!0,t.__zoomLevel),t.__refreshActive&&(t.__refreshActive=!1,t.__refreshDeactivate&&t.__refreshDeactivate()))),t.__positions.length=0}},__publish:function(e,t,i,o){var n=this,r=n.__isAnimating;if(r&&(core.effect.Animate.stop(r),n.__isAnimating=!1),o&&n.options.animating){n.__scheduledLeft=e,n.__scheduledTop=t,n.__scheduledZoom=i;var l=n.__scrollLeft,s=n.__scrollTop,a=n.__zoomLevel,c=e-l,_=t-s,h=i-a;n.__isAnimating=core.effect.Animate.start(function(e,t,i){i&&(n.__scrollLeft=l+c*e,n.__scrollTop=s+_*e,n.__zoomLevel=a+h*e,n.__callback&&n.__callback(n.__scrollLeft,n.__scrollTop,n.__zoomLevel))},function(e){return n.__isAnimating===e},function(e,t,i){t===n.__isAnimating&&(n.__isAnimating=!1),(n.__didDecelerationComplete||i)&&n.options.scrollingComplete(),n.options.zooming&&(n.__computeScrollMax(),n.__zoomComplete&&(n.__zoomComplete(),n.__zoomComplete=null))},n.options.animationDuration,r?p:u)}else n.__scheduledLeft=n.__scrollLeft=e,n.__scheduledTop=n.__scrollTop=t,n.__scheduledZoom=n.__zoomLevel=i,n.__callback&&n.__callback(e,t,i),n.options.zooming&&(n.__computeScrollMax(),n.__zoomComplete&&(n.__zoomComplete(),n.__zoomComplete=null))},__computeScrollMax:function(e){var t=this;null==e&&(e=t.__zoomLevel),t.__maxScrollLeft=Math.max(t.__contentWidth*e-t.__clientWidth,0),t.__maxScrollTop=Math.max(t.__contentHeight*e-t.__clientHeight,0)},__startDeceleration:function(e){var o=this;if(o.options.paging){var t=Math.max(Math.min(o.__scrollLeft,o.__maxScrollLeft),0),i=Math.max(Math.min(o.__scrollTop,o.__maxScrollTop),0),n=o.__clientWidth,r=o.__clientHeight;o.__minDecelerationScrollLeft=Math.floor(t/n)*n,o.__minDecelerationScrollTop=Math.floor(i/r)*r,o.__maxDecelerationScrollLeft=Math.ceil(t/n)*n,o.__maxDecelerationScrollTop=Math.ceil(i/r)*r}else o.__minDecelerationScrollLeft=0,o.__minDecelerationScrollTop=0,o.__maxDecelerationScrollLeft=o.__maxScrollLeft,o.__maxDecelerationScrollTop=o.__maxScrollTop;var l=o.options.snapping?4:.001;o.__isDecelerating=core.effect.Animate.start(function(e,t,i){o.__stepThroughDeceleration(i)},function(){var e=Math.abs(o.__decelerationVelocityX)>=l||Math.abs(o.__decelerationVelocityY)>=l;return e||(o.__didDecelerationComplete=!0),e},function(e,t,i){o.__isDecelerating=!1,o.__didDecelerationComplete&&o.options.scrollingComplete(),o.scrollTo(o.__scrollLeft,o.__scrollTop,o.options.snapping)})},__stepThroughDeceleration:function(e){var t=this,i=t.__scrollLeft+t.__decelerationVelocityX,o=t.__scrollTop+t.__decelerationVelocityY;if(!t.options.bouncing){var n=Math.max(Math.min(t.__maxDecelerationScrollLeft,i),t.__minDecelerationScrollLeft);n!==i&&(i=n,t.__decelerationVelocityX=0);var r=Math.max(Math.min(t.__maxDecelerationScrollTop,o),t.__minDecelerationScrollTop);r!==o&&(o=r,t.__decelerationVelocityY=0)}if(e?t.__publish(i,o,t.__zoomLevel):(t.__scrollLeft=i,t.__scrollTop=o),!t.options.paging){t.__decelerationVelocityX*=.95,t.__decelerationVelocityY*=.95}if(t.options.bouncing){var l=0,s=0,a=t.options.penetrationDeceleration,c=t.options.penetrationAcceleration;i<t.__minDecelerationScrollLeft?l=t.__minDecelerationScrollLeft-i:i>t.__maxDecelerationScrollLeft&&(l=t.__maxDecelerationScrollLeft-i),o<t.__minDecelerationScrollTop?s=t.__minDecelerationScrollTop-o:o>t.__maxDecelerationScrollTop&&(s=t.__maxDecelerationScrollTop-o),0!==l&&(l*t.__decelerationVelocityX<=0?t.__decelerationVelocityX+=l*a:t.__decelerationVelocityX=l*c),0!==s&&(s*t.__decelerationVelocityY<=0?t.__decelerationVelocityY+=s*a:t.__decelerationVelocityY=s*c)}}};for(var t in e)c.prototype[t]=e[t]}();var h=c;return function(){function t(e){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,"designWidth",void 0),r(this,"designLength",void 0),r(this,"contentWidth",void 0),r(this,"contentLength",void 0),r(this,"viewWidth",void 0),r(this,"viewLength",void 0),r(this,"deviceWidth",void 0),r(this,"deviceHeight",void 0),r(this,"maxScroll",1e4),r(this,"storyPosition",0),r(this,"_windowResize",function(){n.deviceOrientation=n._getDeviceOrientation(),n.deviceWidth="portrait"==n.deviceOrientation?n._clientWidth:n._clientHeight,n.deviceHeight="portrait"==n.deviceOrientation?n._clientHeight:n._clientWidth,n._scalePrev=n._scale,n._scale=n.deviceWidth/n.designWidth,n.maxScroll=n.designLength-n.deviceHeight,n.contentWidth=n.deviceWidth,n.contentLength=n.designLength*n._scale,n.viewWidth=n.designWidth,n.viewLength=n.deviceHeight/n._scale,n._setContainerRotation(n.containerFitWindow,n.designOrientation,n.deviceOrientation,n.deviceWidth),n.containerFitWindow.scale.set(n._scale,n._scale),n.app.renderer.resize(n._clientWidth,n._clientHeight);var e="portrait"==n.deviceOrientation?n.deviceWidth:n.contentLength,t="portrait"==n.deviceOrientation?n.contentLength:n.deviceWidth,i="portrait"==n.deviceOrientation?0:n.scrollPosition/n._scalePrev*n._scale||0,o="portrait"!==n.deviceOrientation?0:n.scrollPosition/n._scalePrev*n._scale||0;setTimeout(function(){n.scroller.setDimensions(n._clientWidth,n._clientHeight,e,t),n.scroller.scrollTo(i,o,!1)},200)}),this._defaultSetting(e||{}),this._createContainer(e),this._windowResize()}return function(e,t,i){t&&o(e.prototype,t),i&&o(e,i)}(t,[{key:"chapter",value:function(e,t){var i=new s.Container;return this._setProps(i,e),this._setChapterChildren(i),this._setActions(i),t?t.addChild(i):this.containerScroll.addChild(i),i}},{key:"sprite",value:function(e,t,i){var o=this._createSprite(e);return this._setProps(o,t),this._setActions(o),i?i.addChild(o):this.containerScroll.addChild(o),o}},{key:"spriteAnimated",value:function(e,t,i,o){var n=this._createAnimatedSprite(e,i);return this._setProps(n,t),this._setActions(n),o?o.addChild(n):this.containerScroll.addChild(n),!1!==i&&n.play(),n}},{key:"graphic",value:function(e,t){var i=new s.Graphics;return this._setProps(i,e),this._setActions(i),t?t.addChild(i):this.containerScroll.addChild(i),i}},{key:"text",value:function(e,t,i,o){var n=new s.TextStyle;this._setProps(n,i);var r=new s.Text(e,n);return this._setProps(r,t),this._setActions(r),o?o.addChild(r):this.containerScroll.addChild(r),r}},{key:"actionByStep",value:function(e,t,i,o){void 0===o&&(o=this._getSpriteTriggerPosition(e)),e.actions||(e.actions={});var n=this._createHash(8);return e.actions[n]={action:{type:"section",props:t,section:i,triggerPosition:o}},this.sectionActions.push(l({sprite:e,hash:n},e.actions[n].action)),e}},{key:"setPin",value:function(e,t,i){e.actions||(e.actions={});var o=this._createHash(8);return e.actions[o]={action:{type:"pin",section:i,triggerPosition:t}},this.pinActions.push(l({sprite:e,hash:o},e.actions[o].action)),e}},{key:"stop",value:function(){this.scroller.options.scrollingX=!1,this.scroller.options.scrollingY=!1}},{key:"play",value:function(){this.scroller.options.scrollingX=!0,this.scroller.options.scrollingY=!0}},{key:"_scrollerCallback",value:function(e,t,i){var o=this;this.scrollPosition=this._getSrollPosition(e,t),this.storyPosition=this.scrollPosition/this._scale,"y"==this.scrollDirection?this.containerScroll.y=-this.storyPosition:this.containerScroll.x=-this.storyPosition,this.sectionActions.forEach(function(e){(function(e){var t=e.sprite.actions[e.hash];e.triggerPosition<=this.storyPosition&&this.storyPosition<e.triggerPosition+e.section?i("during",t,e,this.storyPosition):this.storyPosition>=e.triggerPosition+e.section?i("after",t,e,this.storyPosition):this.storyPosition<e.triggerPosition&&i("before",t,e,this.storyPosition);function l(e,t,i,o,n){return o+(i-e)/(t-e)*(n-o)}function i(e,t,i,o){for(var n in e=e||"before",t.originProps=t.originProps||{},i.props)if("object"==a(i.props[n]))for(var r in i.props[n])void 0===t.originProps[n]&&(t.originProps[n]={}),void 0===t.originProps[n][r]&&(t.originProps[n][r]=i.sprite[n][r]),i.sprite[n][r]="before"==e?t.originProps[n][r]:"after"==e?i.props[n][r]:l(i.triggerPosition,i.triggerPosition+i.section,o,t.originProps[n][r],i.props[n][r]);else void 0===t.originProps[n]&&(t.originProps[n]=i.sprite[n]),i.sprite[n]="before"==e?t.originProps[n]:"after"==e?i.props[n]:l(i.triggerPosition,i.triggerPosition+i.section,o,t.originProps[n],i.props[n])}}).call(o,e)}),this.pinActions.forEach(function(e){(function(e){var t=e.sprite.actions[e.hash];t.originProps=t.originProps||{},void 0===t.originProps[this.scrollDirection]&&(t.originProps[this.scrollDirection]=e.sprite[this.scrollDirection]);e.sprite[this.scrollDirection]=t.originProps[this.scrollDirection]-e.triggerPosition+this.storyPosition}).call(o,e)}),this.debug&&"all"==this.debug&&(console.log("top:",t),console.log("left:",e),console.log("scrollPosition :",this.scrollPosition))}},{key:"_defaultSetting",value:function(e){var o=this;this.scrollDirection=e.direction||"y",this.designWidth=e.width||750,this.designLength=e.length||1e4,this.containerSelector=e.container,this.backgroundColor=e.bgcolor,this.useLoader=e.loader||!1,this.debug=e.debug||!1,this._clientWidth=document.documentElement.clientWidth||window.innerWidth,this._clientHeight=document.documentElement.clientHeight||window.innerHeight,this.designOrientation="y"==this.scrollDirection?"portrait":"landscape",this.pinActions=[],this.sectionActions=[],this.loaderList=[],this.scroller=new h(function(e,t,i){return o._scrollerCallback(e,t,i)},{zooming:!1,animating:!0,bouncing:!1,animationDuration:1e3}),this.scroller.__enableScrollY=!0,this.storyPosition=0;var t=!1;document.addEventListener("touchstart",function(e){o.scroller.doTouchStart(e.touches,e.timeStamp),t=!0},!1),document.addEventListener("touchmove",function(e){t&&(o.scroller.doTouchMove(e.touches,e.timeStamp),t=!0)},!1),document.addEventListener("touchend",function(e){t&&(o.scroller.doTouchEnd(e.timeStamp),t=!1)},!1)}},{key:"_createContainer",value:function(e){var t=this,i=1;(window.devicePixelRatio&&(i=window.devicePixelRatio),this.app=new s.Application({width:this._clientWidth*i,height:this._clientHeight*i,backgroundColor:this.backgroundColor,antialias:!0,resolution:1,roundPixels:!0}),this.loader=this.app.loader,this.load=this.app.loader.load,this.loader.on("complete",function(e){return t.useLoader=!1}),void 0===this.containerSelector)?document.body.appendChild(document.createElement("main")).appendChild(this.app.view):document.querySelector(this.containerSelector).appendChild(this.app.view);this.containerFitWindow=new s.Container,this.containerFitWindow.pivot.set(0,0),this.containerScroll=new s.Container,this.containerScroll.name="story",this.containerFitWindow.addChild(this.containerScroll),this.app.stage.addChild(this.containerFitWindow)}},{key:"_getDeviceOrientation",value:function(){return this._clientWidth=document.documentElement.clientWidth||window.innerWidth,this._clientHeight=document.documentElement.clientHeight||window.innerHeight,_?180===window.orientation||0===window.orientation?"portrait":90===window.orientation||-90===window.orientation?"landscape":void 0:this._clientWidth<this._clientHeight?"portrait":"landscape"}},{key:"_setContainerRotation",value:function(e,t,i,o){var n={design_portrait:{device_portrait:{rotation:0,offsetX:0,offsetY:0},device_landscape:{rotation:-Math.PI/2,offsetX:0,offsetY:o}},design_landscape:{device_portrait:{rotation:Math.PI/2,offsetX:o,offsetY:0},device_landscape:{rotation:0,offsetX:0,offsetY:0}}};e.rotation=n["design_"+t]["device_"+i].rotation,e.position.set(n["design_"+t]["device_"+i].offsetX,n["design_"+t]["device_"+i].offsetY)}},{key:"_getCommonProps",value:function(e,t){var i={};for(var o in t)e[o]||"function"==typeof t[o]||(i[o]=t[o]);return i}},{key:"_getSpriteTriggerPosition",value:function(e){var t="x"==this.scrollDirection?e.x:e.y;return e.parent&&"story"!=e.parent.name?t+this._getSpriteTriggerPosition(e.parent):t-2*this.pageHeight/3}},{key:"_getSrollPosition",value:function(e,t){var i,o,n;return(n={design_portrait:{device_portrait:{x:i=e,y:o=t},device_landscape:{x:o,y:i}},design_landscape:{device_portrait:{x:o,y:i},device_landscape:{x:i,y:o}}},function(e,t,i){return n["design_"+e]["device_"+t][i]})(this.designOrientation,this.deviceOrientation,this.scrollDirection)}},{key:"_createSprite",value:function(i){var o=new s.Sprite.from(s.Texture.EMPTY);new s.Loader;return this.useLoader?this.loader.resources[i]?this.loader.on("complete",function(e,t){return o.texture=t[i].texture}):this.loader.add(i,function(e){return o.texture=e.texture}):o.texture=s.Texture.from(i),o}},{key:"_createAnimatedSprite",value:function(e,n){var t=this,r=[],l=new s.AnimatedSprite([s.Texture.EMPTY]);return"object"==a(e)&&0<e.length?this.useLoader?(e.forEach(function(e){t.loader.resources[e]||t.loader.add(e)}),this.loader.on("complete",function(t){e.forEach(function(e){r.push(t.resources[e].texture)}),l.textures=r,!1!==n&&l.play()})):(e.forEach(function(e){r.push(s.Texture.from(e))}),l.textures=r):this.app.loader.add(e,function(e){for(var t in e.data.frames){var i=s.Texture.from(t),o=e.data.frames[t].duration;r.push(o?{texture:i,time:o}:i)}l.textures=r,!1!==n&&l.play()}),l}},{key:"_setActions",value:function(o){var n=this;o.actionByStep=function(e,t,i){return n.actionByStep(o,e,t,i)},o.setPin=function(e,t){return n.setPin(o,e,t)}}},{key:"_setChapterChildren",value:function(o){var n=this;o.sprite=function(e,t){return n.sprite(e,t,o)},o.spriteAnimated=function(e,t,i){return n.spriteAnimated(e,t,i,o)},o.graphic=function(e){return n.graphic(e,o)},o.text=function(e,t,i){return n.text(e,t,i,o)},o.chapter=function(e){return n.chapter(e,o)}}},{key:"_setProps",value:function(e,t){if(t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}},{key:"_createHash",value:function(e){return Array.from(Array(Number(e)||24),function(){return Math.floor(36*Math.random()).toString(36)}).join("")}}]),t}()});