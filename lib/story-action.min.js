/*
 * storyscroll v3.8.0
 * (c) 2021 Little Linghuan & Esone
 * Released under the GPL license
 * ieexx.com
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("storyscroll"),require("gsap/TweenMax")):"function"==typeof define&&define.amd?define(["exports","storyscroll","gsap/TweenMax"],e):e((t=t||self)["StoryScroll-Action"]={},t.StoryScroll,t.TweenMax)}(this,function(t,e,r){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,e.prototype.pointActions=[];const o=e.prototype._setActions;e.prototype._setActions=function(s){o.call(this,s),s.act=(t,e)=>this.act(s,t,e),s.action=(t,e,o)=>this.action(s,t,e,o)},e.prototype._getCommonProps=function(t,e){let o={};for(const s in e)t[s]||"function"==typeof e[s]||(o[s]=e[s]);return o};var s=(e.prototype.act=function(t,e,o){var s=this._getCommonProps(t,e);for(const i in t.tweens=t.tweens||[],e)if("object"==typeof e[i]&&t[i]){const n=r.to(t[i],o,{...e[i],...s});-1==s.repeat&&t.tweens.push(n),delete e[i]}const n=r.to(t,o,e);return-1==e.repeat&&t.tweens.push(n),t},e.prototype.act),n=(()=>{e.prototype.action=function(e,t,o,s){void 0===s&&(s=this._getSpriteTriggerPosition(e)),e.actions||(e.actions={});var n,i=this._getCommonProps(e,t);for(const p in t)"object"==typeof t[p]&&e[p]&&(n=this._createHash(8),e.actions[n]={action:{type:"point",propsRoot:p,props:{...t[p],...i},duration:o,triggerPosition:s}},this.pointActions.push({sprite:e,hash:n,...e.actions[n].action}),delete t[p]);var r=this._createHash(8);return e.actions[r]={action:{type:"point",props:t,duration:o,triggerPosition:s}},this.useLoader&&!this.loaded&&0===s?this.loader.onComplete.add(t=>{setTimeout(()=>{a.call(this,{sprite:e,hash:r,...e.actions[r].action})},this.actionDelaysOnLoaded)}):this.pointActions.push({sprite:e,hash:r,...e.actions[r].action}),e};const s=e.prototype._scrollerCallback;function a(e){let o=e.sprite.actions[e.hash];if(this.storyPosition>=e.triggerPosition){if("acting"!=o.status&&"done"!=o.status){var s=e.propsRoot?e.sprite[e.propsRoot]:e.sprite;let t={...e.props};t.onComplete=function(){o.status="done",e.props.onComplete&&e.props.onComplete.call(this)},t.onReverseComplete=function(){o.status="reversed",e.props.onReverseComplete&&e.props.onReverseComplete.call(this)};s=r.to(s,e.duration,t);o.tween=s,o.status="acting",e.sprite.tweens=e.sprite.tweens||[],-1==e.props.repeat&&e.sprite.tweens.push(s)}}else!1!==e.props.reverse&&("acting"!=o.status&&"done"!=o.status||o.tween&&(o.status="reversing",o.tween.reverse()))}return e.prototype._scrollerCallback=function(t,e,o){s.call(this,t,e,o),this.pointActions.forEach(t=>{a.call(this,t)})},e.prototype.action})(),i={act:s,action:n};t.act=s,t.action=n,t.default=i,Object.defineProperty(t,"__esModule",{value:!0})});